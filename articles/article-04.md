---
title: 对于前端测试的一点杂谈
description: 对前端测试有一个初步认识。
date: 2023-03-10
random: art
tags:
    - HTML
    - CSS
    - REACT
---


## 什么时候我们需要测试

理想情况下，我们当然希望「都有测试，测试覆盖率达到 100%」，但是现实往往无法支撑起这个美好的愿景。

在这种情况下我们在什么时候选择编写测试代码呢？比较核心的几个点是：

1.  核心、高风险业务内容
1.  基础能力提供方，比如基础设施、通用基建，包括本文引子部分的 SDK
1.  对于前端来说基础组件也是可以作为测试的项，比如之前我参与的MiniEx-UI组件

其实从上面我们就可以看出，除了核心业务是为了止损外，大部分可以优先写测试的部分都是因为整体需求开发相对可控，不至于朝令夕改，同时作为基本盘，服务人数众多，牵一发而动全身，一个 Bug，全家完蛋。


## 测试覆盖率

测试需要追求覆盖率，但不要追求覆盖率 100%。

如果没有测试覆盖率指标，那么测试将毫无意义，因为每个人都可以以各种理由偷懒不做测试；但如果过分追求数字，接下来面对的可能是更灾难性的结果：

在个人（开源）项目中自然是想怎么玩都可以的，但在企业开发中我们往往会遇到时间与健壮性的平衡，大部分老板其实只关注「快糙猛」，你先帮我把第一版推上去，剩下的我们之后再说。如果在这种情况下过分追求覆盖率，基本相当于没有人性的强行军，可以先顶一个小目标，比如 80% 覆盖率，而不是 90%-100%。

因为喊个口号容易，但当你实际开始写测试就会发现，要完美覆盖你的 case 而不是只在乎数字的情况下，写测试的时间将是开发时间的 1.5-3 倍，而且是随着覆盖率指标上升指数级上升的，也就是说——有一些犄角旮旯的地方它就是不太好搞，也就是**搞的性价比不高**。


## 测试有什么用途

为我们提供了以下便利：

1.  方便及时发现问题——这是测试本来的功能
1.  通过测试集提供用法的 example——可以有效减少你的文档量，少解说冷门 case
1.  方便后人接盘代码——当有测试的时候，才会知道你写的是 Bug 还是 feature

实际上一个最简单的集成测试本身就是一个 Quick Start，可以直接贴测试用，而我们通常会同时加上注释，巧了，代码的可读性又上升了。

## 前端的测试

常见的测试还是单元测试和集成测试。

这里以埋点库 SDK 为例，因为 UI 业务上的单元测试发挥空间比较有限，相对的费力不讨好一些，前端 SDK 的 case 更典型（简单）且全面。

### 单元测试

说起单元测试，我们最先想到的肯定是 `jest`，老牌测试了，关于怎么使用可以看[官方文档](https://link.juejin.cn?target=https%3A%2F%2Fjestjs.io%2F "https://jestjs.io/")和各种文章；此外，我们最后的遗作 SDK 已经使用了 [Vitest](https://link.juejin.cn?target=https%3A%2F%2Fvitest.dev%2F "https://vitest.dev/")，理论上应该是比 jest 更好用一些的。

大部分情况下我们更多的开发思路还是：

1.  我的库需要提供哪些能力
1.  这些能力怎么拆分成函数（尽量无副作用）
1.  挨个覆盖我 export 的函数
1.  对于想到的边缘 case 进行填补

单元测试最难的部分可能是要挨个 mock 你需要的部分，同时为了避免干扰，建议少用全局变量、多写无副作用函数，能让你的开发之旅顺利很多。

对于大部分基建项目来说，单元测试是一件性价比相当高的方式，非常建议大家抽空做一波。（当然，很容易 mock 麻了，比如我卷到最后就卷不下去了，要 mock 太多东西了）。

### 集成测试

其实对于单元测试来说，前后端并没有太大区别，前端 mock 浏览器、网络 IO；后端 mock 网络 IO、底层依赖、文件存储，本质上都是 mock + 对函数进行测试。

对于集成测试来说就更为痛苦，在这里我们努力的使用 [cypress](https://link.juejin.cn?target=https%3A%2F%2Fwww.cypress.io%2F "https://www.cypress.io/")，如果说单元测试测的是函数，那么集成测试测的就是能力，简化一下上面在单测中介绍的思路：

1.  我的库需要提供哪些能力
1.  用代码怎么实现
1.  覆盖我设计的能力
1.  对于想到的边缘 case 进行填补

可以说，如果单元测试还是要你具体代码拆分后再进行测试的设计，那么集成测试从一开始就可以进行设计了——毕竟在系统设计阶段，你已经会敲定「我会提供什么」了。

剩下的可能就是漫长而痛苦的 mock 阶段，甚至你可能需要准备好一个 server 去承载你的测试页面。

## 总结

对于大部分刚开始写测试的工程师来说，卡点可能更多的在于怎么去取舍和怎么去设计我的测试用例，这里简单的提供一些思路，至于具体库的使用上，网上已经有太多基础教程，而坑就靠 stackoverflow 和 GitHub issues 去填补吧。

而为什么大家都懒得写测试——根据本人实际的测试体验，更多的不是测试，而在于 mock，漫长而痛苦。

展望未来，自然是希望 AI 能够解决我们大部分烦恼的，虽说chatgpt已经能实现了。

  
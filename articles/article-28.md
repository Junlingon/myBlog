---
title: react状态管理仓库之jotai
description: 实习中学到的新知识
date: 2023-11-27
random: shanghai 
tags:
    - react
---

## Hooks 时代
Hooks  是 React 16.8 新增的特性，使得我们可以在函数组件中使用 state 以及其他 React 特性。    
Hooks 的引入主要是为了解决 React Class 组件的以下问题：  

### 在组件之间复用状态逻辑很难

Class 组件会将视图和状态逻辑糅杂在一起，如果想复用组件中的状态逻辑，需要使用 render props 和高阶组件，但是这类方案需要重新组织组件结构，会形成组件的嵌套地狱，代码逻辑也会变得难以理解。

### 复杂组件的理解成本很高

Class 组件的状态逻辑会充斥在各个生命周期中，完全不相关的代码出现在同一个生命周期函数中，逻辑难以理解，容易引发 bug，且在多数情况下，很难将组件拆分成更小的粒度。  
Hooks 是一种开发理念和组织理念的革新，有 3 个特性：

- primitive。元数据化，将混沌的 state 打散为一个个元数据；
- decentralization。去中心化，Class 时代的理念是“顶层下发”，Hooks 带来了强烈的“组件自治”理念；
- algebraic effects。代数效应，剥离组件中的副作用，让开发者更专注业务逻辑。

代数效应是函数式编程中的一个概念，用于将副作用从函数调用中分离。

## 自下而上模式的崛起
我们可以看到以前的状态管理解决方案，如Redux，设计理念是状态 「自上而下」流动。它「倾向于在组件树的顶端吸走所有的状态」。状态被维护在组件树的高处，下面的组件通过选择器拉取他们需要的状态。  
在新的组件构建理念中，一种「自下而上」的观点对构建具有组合模式的应用具有很好的指导作用。  
而hook就是这种理念的践行者，即把可组合的部件放在一起形成一个更大的整体。  
通过 hook，我们可以从具有巨大全局存储的「单体状态管理」转变为向自下而上的 「微状态管理」，通过hook消费更小的状态片。  
像接下来要介绍的 Jotai 这样的流行库以其 「原子状态」的概念体现了这种自下而上的理念。「原子是一个最小但完整的状态单位」。  它是小块的状态，可以连接在一起形成新的衍生状态。最终形成了一个应用状态图。
这个模型允许你自下而上地建立起「状态图」。并通过仅使图中已更新的原子失效来优化渲染。
这与拥有一个大的单体状态球形成鲜明对比，你可以「订阅并试图避免不必要的渲染」。

## Jotai
jotai 🇯🇵 日语 "状态"  
jotai 是一个小型全局状态管理库，它模仿了 useState、useReducer。jotai 有个叫做 atom 的概念，用于表示小的状态片段。和 zustand 不同的是，他是一个组件级别的状态管理库。和 zustand 相同的是同样都基于不可变状态模型。
jotai 是 Context 和订阅机制的结合，是面向 React 的一种全局状态管理库。如果你的需求是一个没有额外重复渲染的 Context，那 jotai 是个不错的选择。

### jotai 有两个特点：

+ 语法简单
+ jotai 的状态不是全局状态
  
atom 可以在 React 组件的生命周期里创建和销毁。这通过多个 Context 是无法实现的，因为使用 Context 增加一个新的 state 意味着增加一个新的 Provider 组件，如果新增一个组件，它所有的子组件都会被重新挂载，会失去所有状态。

+ 衍生 atom

atom 可以像积木一样被组合，生成新的 atom，从而实现复杂逻辑。
jotai 通过 atom 之间的依赖来实现自动渲染优化。  
推荐场景：组件为中心的应用。

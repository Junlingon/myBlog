---
title: React16ã€17ã€18ç‰ˆæœ¬åŒºåˆ«
description: ä»èƒŒæ™¯å’Œè§£å†³çš„ç—›ç‚¹æ¥é˜è¿°
date: 2023-03-25
random: art
tags:
    - HTML
    - CSS
    - REACT
---

# react-16
+ *æ¸²æŸ“æ€§èƒ½é—®é¢˜*ï¼šæ—©æœŸé‡‡ç”¨çš„æ˜¯ Stack Reconciliation ç®—æ³•ï¼Œåœ¨ç»„ä»¶çŠ¶æ€å˜åŒ–æ—¶è¿›è¡Œä¾æ¬¡é€’å½’æ¯”è¾ƒæ›´æ–°ï¼Œæ— æ³•åœ¨ä¸­é€”ä¸­æ–­ï¼Œé€ æˆè§†å›¾çš„é˜»å¡æ¸²æŸ“ã€‚è€Œ React Fiber ç®—æ³•æ”¹è¿›äº† Stack Reconciliationï¼Œé‡‡äº†ä¸€ç§æ—¶é—´åˆ†ç‰‡æŠ€æœ¯ï¼Œå¯ä»¥æŠŠä¸€ä¸ªæ›´æ–°ä»»åŠ¡åˆ†ç‰‡ï¼Œæ¯ä¸ªç‰‡æ®µè®©å‡ºæ‰§è¡Œæƒç»™æµè§ˆå™¨ï¼Œå…¶ä»–ä»»åŠ¡åˆ™ç­‰å¾…ï¼›åœ¨æ–°çš„ä»»åŠ¡åˆ°æ¥æ—¶ï¼Œå®ƒä¼šä¸­æ–­ä¹‹å‰çš„ä»»åŠ¡ï¼Œé‡æ–°åˆ†é…æ—¶é—´ç‰‡ä»¥ä¿è¯ä¼˜å…ˆçº§çš„åˆç†æ€§ï¼Œæé«˜é¡µé¢æ€§èƒ½ã€‚

+ *ç»„ä»¶å¤æ‚åº¦é—®é¢˜*ï¼šç±»å¼ç»„ä»¶éœ€è¦ç»´æŠ¤ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€çŠ¶æ€å±æ€§ã€äº‹ä»¶å¤„ç†ç­‰å¾ˆå¤šé€»è¾‘ï¼Œéšç€ç»„ä»¶å¤æ‚åº¦çš„å¢åŠ ï¼Œä¸æ˜“äºç»„ä»¶é€»è¾‘çš„å¤ç”¨ï¼Œè€Œ Hooks çš„å‡ºç°è¢«è®¤ä¸ºæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€æ¬¡è¿›æ­¥ï¼Œå®ƒå¯ä»¥æŠŠé€»è¾‘è§£è€¦æˆå¤šä¸ªæ›´å°çš„ï¼Œå•ç‹¬çš„ï¼Œæ¯”è¾ƒè¿è´¯çš„å‡½æ•°å•å…ƒï¼Œä¾¿äºç»„é€»è¾‘çš„å°è£…å’Œé‡ç”¨ã€‚

+ *ç»„ä»¶ä¹‹é—´çŠ¶æ€å…±äº«é—®é¢˜*ï¼šä¹‹å‰å®ç°ç»„ä»¶çš„çŠ¶æ€å…±äº«æ˜¯é€šè¿‡çŠ¶æ€æå‡å’Œ HOC æ–¹å¼è€Œ Hooks çš„ useReducerã€useContext å’Œ useImperativeHandle ç­‰é’©å­å‡½æ•°å¯ä»¥åœ¨ç»„ä»¶é—´è·¨å±‚çº§å…±äº«çŠ¶æ€ï¼Œåœ¨ä¿è¯ç»„ä»¶å°è£…ä¸å¤ç”¨çš„åŒæ—¶å¢å¼ºç»„ä»¶çš„çµæ´»æ€§å’Œé€šç”¨æ€§ã€‚

+ *ç»„ä»¶å¤æ‚åº¦å’Œå¯ç»´æŠ¤æ€§é—®é¢˜*ï¼šåœ¨ æä¾›çš„é’©å­å‡½æ•° API ä¸‹ï¼Œç»„ä»¶çš„å‡½æ•°é—´è°ƒç”¨æ„æˆäº†ç›´æ¥çš„å›¾å½¢åŒ–ç»“æ„ï¼Œæ–¹ä¾¿å¼€å‘è€…æŸ¥çœ‹ä»£ç è°ƒè¯•ç”¨ä¾‹ï¼Œå¯ç»´æŠ¤æ€§æ›´åŠ é«˜æ•ˆã€‚åŒæ—¶ï¼Œç”±äºæäº† state å’Œ effect ç­‰é’©å­å‡½æ•° APIï¼Œè¿›ä¸€æ­¥åœ°æŠŠä¸åŒçš„é€»è¾‘æ¸…æ™°åœ°æ‹†åˆ†å¼€ï¼Œä½¿ä»£ç é€»è¾‘æ›´å…·å¯è¯»æ€§ã€‚  

å› æ­¤ï¼ŒReact 16 ç‰ˆæœ¬ä¸­å¼•å…¥ Hooks å’Œ React Fiber æ˜¯ä¸ºäº†è§£å†³ React æ—©æœŸåœ¨æ€§èƒ½ã€å¤æ‚åº¦å’Œå¯ç»´æŠ¤æ€§ä¸Šå­˜åœ¨çš„é—®é¢˜ï¼Œè®©å¼€å‘è€…æ›´åŠ é«˜æ•ˆåœ°å¼€å‘ React åº”ç”¨ã€‚



# react-17ç‰ˆæœ¬æ–°ç‰¹æ€§
çœ‹Bç«™è§†é¢‘ä¸Šä¸€ä¸ªè€å¸ˆè¯´ï¼Œ17ç‰ˆæœ¬çš„æœ€å¤§ç‰¹ç‚¹å°±æ²¡ç‰¹ç‚¹ğŸŒŸ  
**React 17 ç‰ˆæœ¬ä¸»è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š**  

+ ä»£ç è¿ç§»é—®é¢˜ï¼šç”±äº React 17 ç‰ˆæœ¬ä¸­ä¸å†é€šè¿‡äº‹ä»¶å§”æ´¾æ–¹å¼å®ç°äº‹ä»¶å¤„ç†ï¼Œè€Œé‡‡ç”¨äº†ç›´æ¥ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°çš„æ–¹å¼ï¼Œè¿™å°±æ„å‘³ç€åœ¨ React ä¸­åŸæœ¬ç”± event å¯¹è±¡ä¼ é€’äº‹ä»¶å¤„ç†é€»è¾‘çš„æ–¹å¼æ— æ³•å†ä½¿ç”¨ï¼Œéœ€è¦å¯¹ä»£ç è¿›è¡Œä¿®æ”¹å’Œé€‚é…ï¼Œè¿™æ ·ä¼šå½±å“åˆ°å·²ç»å­˜åœ¨çš„ React åº”ç”¨çš„è¿ç§»å·¥ä½œã€‚React 17 å°†è¿›è¡Œå‘åå…¼å®¹ä¸­æ–­ï¼Œä¿è¯æ—§ç‰ˆæœ¬ä»ç„¶æŒ‰ç…§ä»¥å‰çš„æ–¹å¼è¿è¡Œï¼ŒåŒæ—¶åœ¨æ–°ç‰ˆæœ¬ä¸­é€æ­¥å¼•å…¥æ–°çš„ APIï¼Œç»™äºˆç”¨æˆ·æ›´é•¿çš„è°ƒæ•´æ—¶é—´ï¼Œä½¿ä»£ç è¿ç§»å˜å¾—æ›´åŠ å¹³æ»‘ã€‚  

+ äº‹ä»¶å¤„ç†é—®é¢˜ï¼šåœ¨ React 16 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œäº‹ä»¶å¤„ç†çš„æœºåˆ¶é‡‡ç”¨çš„æ˜¯äº‹ä»¶å§”æ´¾ï¼Œåœ¨äº‹ä»¶å†’æ³¡é˜¶æ®µå¤„ç†äº‹ä»¶ï¼Œä½†è¿™ç§æ–¹å¼å®¹æ˜“å¯¼è‡´äº‹ä»¶æ€§èƒ½é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚åº”ç”¨ä¸­ï¼Œå¤§é‡äº‹ä»¶ç»‘å®šä¼šå¢åŠ æ¼«é•¿çš„äº‹ä»¶å†’æ³¡å’Œä¾æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œä»è€Œå½±å“é¡µé¢çš„æ€§èƒ½ã€‚è€Œ React 17 ç‰ˆæœ¬ä¸­é€šè¿‡ç›´æ¥ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°çš„æ–¹å¼æ¥å¤„ç†äº‹ä»¶ï¼Œä»è€Œå‡å°‘äº†å†’æ³¡è¿‡ç¨‹ä¸­çš„æ€§èƒ½æ¶ˆè€—ã€‚  

æ€»ä¹‹ï¼ŒReact 17 çš„èƒŒæ™¯æ˜¯ä¸ºäº†ä¿è¯ React åº”ç”¨çš„å…¼å®¹æ€§å’Œç¨³å®šæ€§ï¼Œåœ¨è§£å†³äº‹ä»¶å¤„ç†é—®é¢˜çš„åŒæ—¶ï¼Œè¿˜èƒ½å…¼é¡¾å‘åå…¼å®¹ï¼Œé€æ¸å¼•å…¥æ–°çš„ APIï¼Œä¾¿äºå¼€å‘è€…æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œä½¿ç”¨ï¼Œè¿™ä¹Ÿæ˜¯ React é•¿æœŸç»´æŠ¤çš„é‡è¦ä¸¾æªã€‚


# react-18ç‰ˆæœ¬æ–°ç‰¹æ€§
### ä¸€ã€å®¢æˆ·ç«¯æ¸²æŸ“ API

å¸¦æœ‰ createRoot() çš„ root APIï¼Œæ›¿æ¢ç°æœ‰çš„ render() å‡½æ•°ï¼Œæä¾›æ›´å¥½çš„äººä½“å·¥ç¨‹å­¦å¹¶å¯ç”¨æ–°çš„å¹¶å‘æ¸²æŸ“ç‰¹æ€§ã€‚

```js
import { createRoot } from "react-dom/client";
import { useState } from 'react'

const App = () => {
  const [A, setA] = useState(1);
  const [B, setB] = useState(1);
  
  const handleClick = () => {
    setA((a) => a + 1);
    setB((b) => b - 1);
  };

  setTimeout(() => {
    setA((a) => a + 1);
    setB((b) => b - 1);
  }, 1000);
  
  return (<div>
    <p>{A}</p>
    <p>{B}</p>
  </div>);
};

const container = document.getElementById("app");
const root = createRoot(container);
root.render(<App />);

root.unmount(); //å¸è½½ç»„ä»¶
```
å¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨äº†ssræœåŠ¡ç«¯æ¸²æŸ“ï¼Œéœ€è¦æŠŠReactDOM.hydrateå‡çº§ä¸ºReactDOM.hydrateRoot

```js
import { hydrateRoot } from "react-dom/client";

const container = document.getElementById("app");
const root = hydrateRoot(container, <App tab="home" />);
```
åœ¨æŸäº›åœºæ™¯ä¸‹ æˆ‘ä»¬å¯èƒ½ä¸éœ€è¦æ‰¹å¤„ç†çŠ¶æ€æ›´æ–°, æ­¤æ—¶æˆ‘ä»¬éœ€è¦ç”¨åˆ° react-dom æä¾›çš„flushSyncå‡½æ•°, è¯¥å‡½æ•°éœ€ä¼ å…¥ä¸€ä¸ªå›è°ƒ, å¹¶ä¸”ä¼šåŒæ­¥åˆ·æ–°å›è°ƒä¸­çš„çŠ¶æ€æ›´æ–°

```js
import { useState } from 'react'
import { flushSync } from 'react-dom'
 
function App() {
  const [num1, setNum1] = useState(1)
  const [num2, setNum2] = useState(1)
  
  const add = () => {
    setTimeout(() => {
      flushSync(() => {
        setNum1((pre) => pre + 1)
      })
      
      flushSync(() => {
        setNum2((pre) => pre + 1)
      })
    })
  }
  console.log('æ¸²æŸ“äº†')
  console.log(num1, num2)
  
  return (
    <div className="App">
      <header className="App-header">react 18</header>
      <p>num1 : {num1}</p>
      <p>num2 : {num2}</p>
      <button onClick={add}>+1</button>
    </div>
  )
}
 
export default App
```

### äºŒã€ä¸¥æ ¼æ¨¡å¼æ›´æ–°

React 18 å¸¦æ¥äº†å¤§æŠŠæ–°ç‰¹æ€§ï¼Œæ­¤å¤–è¿˜æœ‰å¾ˆå¤šæ–°ç‰¹æ€§æ­£åœ¨è·¯ä¸Šã€‚ä¸ºäº†è®©ä½ çš„ä»£ç ä¸ºæ­¤åšå¥½å‡†å¤‡ï¼ŒStrictMode å˜å¾—æ›´åŠ ä¸¥æ ¼äº†ã€‚æœ€é‡è¦çš„æ˜¯ï¼ŒStrictMode å°†æµ‹è¯•ç»„ä»¶å¯¹å¯é‡ç”¨çŠ¶æ€çš„å¼¹æ€§ï¼Œæ¨¡æ‹Ÿä¸€ç³»åˆ—çš„æŒ‚è½½å’Œå¸è½½è¡Œä¸ºã€‚å®ƒæ—¨åœ¨è®©ä½ çš„ä»£ç ä¸ºå³å°†æ¨å‡ºçš„ç‰¹æ€§ï¼ˆå¯èƒ½ä»¥ç»„ä»¶çš„å½¢å¼ï¼‰åšå¥½å‡†å¤‡ï¼Œè¿™å°†åœ¨ç»„ä»¶çš„æŒ‚è½½å‘¨æœŸä¸­ä¿ç•™è¿™ä¸ªçŠ¶æ€ã€‚

è™½ç„¶å®ƒè‚¯å®šä¼šåœ¨æœªæ¥æä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œä½†å°±ç›®å‰è€Œè¨€ï¼Œå¯ç”¨ StrictMode æ—¶å¿…é¡»è¦è€ƒè™‘è¿™ä¸ªäº‹æƒ…ã€‚

é™¤äº†ä»¥ä¸Šæåˆ°çš„æ›´æ”¹ä¹‹å¤–ï¼Œæ ¹æ®ä½ çš„ React ä»£ç åº“ï¼Œä½ å¯èƒ½è¿˜ä¼šå‘ç°å…¶ä»–ä¸€äº›æ›´æ”¹ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒReact 18 å°†ä¸å†æ”¯æŒ IE æµè§ˆå™¨ï¼Œå› ä¸º React 18 ç°åœ¨ä¾èµ–å¾ˆå¤šç°ä»£æµè§ˆå™¨ç‰¹æ€§ï¼Œå¦‚ Promise æˆ– Object.assignã€‚

å…¶ä½™çš„æ›´æ”¹ä¸ä¸€äº› React è¡Œä¸ºçš„ç¨³å®šæ€§å’Œä¸€è‡´æ€§æœ‰å…³ï¼Œä¸å¤ªå¯èƒ½å½±å“ä½ çš„ä»£ç åº“ã€‚

### ä¸‰ã€Transition

Transition æ˜¯ç”±å¹¶å‘æ¸²æŸ“æä¾›æ”¯æŒçš„æ–°ç‰¹æ€§ä¹‹ä¸€ã€‚å®ƒæ—¨åœ¨ä¸ç°æœ‰çŠ¶æ€ç®¡ç† API ä¸€èµ·ä½¿ç”¨ï¼Œä»¥åŒºåˆ†ç´§æ€¥å’Œéç´§æ€¥çŠ¶æ€æ›´æ–°ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒReact çŸ¥é“å“ªäº›æ›´æ–°éœ€è¦ä¼˜å…ˆè€ƒè™‘ï¼Œå“ªäº›æ›´æ–°éœ€è¦åœ¨åå°é€šè¿‡å¹¶å‘æ¸²æŸ“å‡†å¤‡ã€‚

```js
import { useTransition, useState } from "react";

const App = () => {
  const [isPending, startTransition] = useTransition();
  const [value, setValue] = useState(0);

  function handleClick() {
    startTransition(() => {
      setValue((value) => value + 1);
    });
  }

  return (
    <div>
      {isPending && <Loader />}
      <button onClick={handleClick}>{value}</button>
    </div>
  );
};
```

åœ¨ startTransition() å›è°ƒä¸­æäº¤çš„ä»»ä½•çŠ¶æ€æ›´æ–°éƒ½å°†è¢«æ ‡è®°ä¸º transitionï¼Œä»è€Œä½¿å…¶ä»–æ›´æ–°å…·æœ‰ä¼˜å…ˆæƒã€‚å¦‚æœä½ ä¸èƒ½ä½¿ç”¨è¿™ä¸ªé’©å­ï¼Œè¿˜æœ‰ä¸€ä¸ªå•ç‹¬çš„ startTransition() å‡½æ•°å¯ç”¨â€”â€”è™½ç„¶å®ƒä¸ä¼šé€šçŸ¥ä½ è½¬æ¢çš„è¿›åº¦ã€‚

```js
import { startTransition } from "react";
// ...
startTransition(() => {
  // Transition updates
});
// ...
```
# React 16ã€17ã€18çš„ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š

React 16ï¼š

-   å¼•å…¥äº†Fiberæ¶æ„ï¼Œå¯ä»¥å®ç°æ›´é«˜æ•ˆçš„æ¸²æŸ“æ§åˆ¶å’Œè°ƒåº¦ï¼›
-   æ”¯æŒError Boundariesï¼Œå¯ä»¥æ›´å¥½åœ°å¤„ç†ç»„ä»¶æ¸²æŸ“æ—¶çš„é”™è¯¯ï¼›
-   æ”¯æŒPortalsï¼Œå¯ä»¥å°†ç»„ä»¶æ¸²æŸ“åˆ°DOMæ ‘ä¹‹å¤–çš„ä»»æ„ä½ç½®ï¼›
-   æ”¯æŒæ–°çš„Context APIï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°å®ç°è·¨ç»„ä»¶çš„çŠ¶æ€å…±äº«ã€‚

React 17ï¼š

-   æ”¹è¿›äº†äº‹ä»¶ç³»ç»Ÿï¼Œå¯ä»¥æ›´å¥½åœ°å¤„ç†åŸç”ŸDOMäº‹ä»¶ï¼›
-   æ”¹è¿›äº†è‡ªå®šä¹‰DOMå±æ€§çš„å¤„ç†æ–¹å¼ï¼Œå¯ä»¥æ›´å¥½åœ°éµå¾ªHTMLæ ‡å‡†ï¼›
-   æ”¹è¿›äº†Server Renderingï¼Œå¯ä»¥æ›´å¥½åœ°æ”¯æŒå¼‚æ­¥æ•°æ®åŠ è½½å’Œæ¸²æŸ“ã€‚

React 18ï¼š

-   å¼•å…¥äº†æ–°çš„å‡½æ•°å¼ç»„ä»¶APIï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°ç¼–å†™æ— çŠ¶æ€ç»„ä»¶ï¼›
-   æ”¹è¿›äº†React Server Componentsï¼Œå¯ä»¥æ›´å¥½åœ°æ”¯æŒServer Renderingï¼›
-   å¼•å…¥äº†æ–°çš„æ¸è¿›å¼å‡çº§åŠŸèƒ½ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°å‡çº§åº”ç”¨ç¨‹åºï¼›
-   å¼•å…¥äº†æ–°çš„æ€§èƒ½åˆ†æå·¥å…·ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°å®šä½æ€§èƒ½é—®é¢˜ã€‚

æ€»çš„æ¥è¯´ï¼ŒReact 17å’ŒReact 18ä¸»è¦æ˜¯åœ¨æ€§èƒ½å’Œå¼€å‘ä½“éªŒæ–¹é¢è¿›è¡Œäº†æ”¹è¿›å’Œä¼˜åŒ–ï¼Œè€ŒReact 16åˆ™æ˜¯åœ¨æ¶æ„å’ŒåŠŸèƒ½æ–¹é¢è¿›è¡Œäº†å‡çº§ã€‚å¼€å‘è€…å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œåœºæ™¯é€‰æ‹©é€‚åˆè‡ªå·±çš„Reactç‰ˆæœ¬ã€‚


